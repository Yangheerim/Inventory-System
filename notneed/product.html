<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome!</title>
    <link rel="stylesheet" href="../css/bootstrap.css"> <!-- 부트스트랩에서 제공하는 css파일을 이용하겠다-->
</head>
<body>
<!--계정-->
<!-- - User1 : id / password / 이름 / email / 업체 / 매니저인지아닌지 / 승인여부-->

<body class="bg-gradient-primary">

<div class="container">

    <!-- Outer Row -->
    <div class="row justify-content-center">

        <div class="col-lg-20 col-md-20 col-md-12 align-self-center">

            <div class="card o-hidden border-0 shadow-lg my-5">
                <div class="card-body p-0">
                    <!-- Nested Row within Card Body -->
                    <div class="row justify-content-center">
                        <div class="col-md-12">
                            <div class="p-5">
                                <div class="text-center">
                                    <h1 class="h4 text-gray-900 mb-4">Product View</h1>
                                </div>
                                <form class="product">
                                    <div class="form-group row">
                                        <div class = "col-8">
                                            <input type="text" class="form-control form-control-user" id="searchIn">
                                        </div>
                                        <div class = "col-1">
                                            <a class="btn btn-secondary text-white btn-user btn-sm" id="search">Search</a>
                                        </div>
                                        <div class = "col-1">
                                            <a class="btn btn-secondary text-white btn-user btn-sm" id="newProduct" data-toggle="modal" data-target="#newProductModal">New</a>
                                        </div>
                                        <div class = "col-1">
                                            <a class="btn btn-secondary text-white btn-user btn-sm" id="modiProduct"data-toggle="modal" data-target="#modiProductModal">Modify</a>
                                        </div>
                                        <div class = "col-1">
                                            <a class="btn btn-secondary text-white btn-user btn-sm" id="delProduct">Delete</a>
                                        </div>
                                    </div>

                                    <div class="modal-body ">
                                        <table class="table table-sm">
                                            <thead class="thead-light ">
                                            <tr>
                                                <th scope="col">ProductCode</th>
                                                <th scope="col">Name</th>
                                                <th scope="col">Color</th>
                                                <th scope="col">Size</th>
                                                <th scope="col">Stock</th>
                                                <th scope="col">Select</th>

                                            </tr>
                                            </thead>
                                            <tbody id="product_list">

                                            </tbody>
                                        </table>
                                    </div>
                                </form>

                                <tbody>


                                </tbody>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!--New 버튼 클릭시-->
<div class="modal fade" id="newProductModal" tabindex="-1" role="dialog" >
    <div class="modal-dialog modal-dialog-centered " role="document">
        <div class="modal-content align-self-center">
            <div class="modal-header">
                <h6 class="modal-title" id="newProductModalLabel">Product Registration</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                *Product Code (자유롭게 입력 가능합니다.)
                <div class="form-group row">
                    <div class="col-8">
                        <input type="text" class ="form-control form-control-user" id="productCodeNew">
                        <small id="productCodeNoti" class="form-text text-danger">중복 확인을 해주세요</small>
                    </div>
                    <div class="col-4">
                        <a class="btn btn-secondary text-white btn-user btn-sm" id="codeDuplicateButton">Duplicate Check</a>
                    </div>
                </div>
                <div class="form-group">
                    *Product Name
                    <input type="text" class="form-control form-control-user" id="productNameNew">
                </div>
                <div class="form-group">
                    *Stock
                    <input type="integer" class="form-control form-control-user" id="productStockNew">
                </div>
                <div class="form-group">
                    *Barcode Number
                    <input type="text" class="form-control form-control-user" id="productBarcodeNew">
                </div>
                (Optional)
                <div class="form-group">
                    Size
                    <input type="text" class="form-control form-control-user" id="productSizeNew" >
                </div>
                <div class="form-group">
                    Color
                    <input type="text" class="form-control form-control-user" id="productColorNew">
                </div>
            </div>

            <!--// 모든 입력창을 다 입력해달라는 경고창 -->
            <div id="empty_alert2" style="display:none;" class="alert alert-danger">
                Please enter every * information!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="newProductButton">Register</button>
            </div>
        </div>
    </div>
</div>


<!-- Modify 버튼 클릭시 -->
<div class="modal fade" id="modiProductModal" tabindex="-1" role="dialog" >
    <div class="modal-dialog modal-dialog-centered " role="document">
        <div class="modal-content align-self-center">
            <div class="modal-header">
                <h6 class="modal-title" id="modiProductLabel">Product Modifier</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    Product Code
                    <input type="text" class ="form-control form-control-user" id="productCodeModi" disabled>
                </div>
                <div class="form-group">
                    Product Name
                    <input type="integer" class="form-control form-control-user" id="productNameModi" disabled>
                </div>
                <div class="form-group">
                    *Stock
                    <input type="integer" class="form-control form-control-user" id="productStockModi">
                </div>

                (Optional)
                <div class="form-group">
                    Size
                    <input type="text" class="form-control form-control-user" id="productSizeModi" disabled>
                </div>
                <div class="form-group">
                    Color
                    <input type="text" class="form-control form-control-user" id="productColorModi" disabled>
                </div>

            </div>

            <!--// 모든 입력창을 다 입력해달라는 경고창 -->
            <div id="empty_alert3" style="display:none;" class="alert alert-danger">
                변화한 Stock을 입력해주세요.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="modiProductButton">Modify</button>
            </div>
        </div>
    </div>
</div>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src='../js/bootstrap.js'></script>

<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyAJHIyMYLbLaou3TC9Jxu7bCrvY9mvA5v8",
        authDomain: "inventorysystem-7f9cb.firebaseapp.com",
        databaseURL: "https://inventorysystem-7f9cb.firebaseio.com",
        projectId: "inventorysystem-7f9cb",
        storageBucket: "inventorysystem-7f9cb.appspot.com",
        messagingSenderId: "301963214438",
        appId: "1:301963214438:web:d6db327dab10860852b7a7",
        measurementId: "G-568LQ0P1QB"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    var database = firebase.database();
    var auth = firebase.auth();
</script>

<script type="text/javascript">

    // new 버튼 클릭시
    document.getElementById('newProductButton').onclick = function () {

        var account_duplicate_noti = document.getElementById('productCodeNoti');

        if(account_duplicate_noti.className == "form-text text-success") {

            console.log("Here is createProductButton !!!");
            var productCode = document.getElementById("productCodeNew").value.trim();
            var productName = document.getElementById("productNameNew").value.trim();
            var size = document.getElementById("productSizeNew").value.trim();
            var color = document.getElementById("productColorNew").value.trim();
            var stock = document.getElementById("productStockNew").value.trim();
            var barcode = document.getElementById("productBarcodeNew").value.trim();
            var history = new Array();

            if (productCode == "" || productName == "" || stock == "" || barcode == "") {
                var alert_message = document.getElementById('empty_alert');
                alert_message.style = "display:visible;"

            } else {
                database.ref('prod/').push().set({
                    productCode: productCode,
                    productName: productName,
                    size: size,
                    color: color,
                    stock: stock,
                    barcode: barcode,
                    history: history
                });

                $('#newProductModal').modal('hide')
                alert("등록이 완료되었습니다.");
            }
        } else{
            alert("제품코드 중복확인을 해주세요.");
        }
    };


    // 제품코드 중복확인
    document.getElementById('codeduplicateButton').onclick = function () {

        var inputProdCode = document.getElementById("productCodeNew").value.trim();
        var code_duplicate_noti = document.getElementById('productCodeNoti');

        if(inputProdCode == ""){
            code_duplicate_noti.innerText = "제품 판별코드를 입력하세요."
            code_duplicate_noti.className = "form-text text-danger"
        }else {
            var result = true;
            var dbProdRef = database.ref().child('/prod');

            dbProdRef.once("value")
                .then(function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        var childData = childSnapshot.val();
                        if (childData.productCode == inputProdCode) {
                            result = false;
                        }
                    });
                    if (result) {
                        code_duplicate_noti.innerText = "사용 가능한 제품 코드입니다."
                        code_duplicate_noti.className = "form-text text-success"
                    } else {
                        code_duplicate_noti.innerText = "사용 불가능한 제품 코드입니다."
                        code_duplicate_noti.className = "form-text text-danger"
                    }

                });

        }

    }



    // modify 버튼 클릭시
    document.getElementById('modiProductButton').onclick = function () {
        var account_duplicate_noti = document.getElementById('productCodeNoti');
        var time = new Date().toLocaleString().trim();

        if(account_duplicate_noti.className == "form-text text-success") {

            console.log("Here is createAccountButton !!!");
            var stock = document.getElementById("productStockModi").value.trim();

            var authority = $('input[name="employee_authority"]:checked').val();
            var approval_result = false;
            if($('input[name="employee_authority"]:checked').val() == "Manager"){
                approval_result = true;
            }

            if (stock == "") {
                var alert_message = document.getElementById('empty_alert');
                alert_message.style = "display:visible;"

            } else {
                database.ref('Prod/').companyUid.ref('Hisotry').push().set({
                    stock: stock,
                    time: time,
                    authority: authority,
                    approval: approval_result
                });

                alert("등록이 완료되었습니다.");
                location.href = "index.html";
            }
        }
    };



    // 새로운 비즈니스 등록 시
    document.getElementById('newBusinessCreate').onclick = function () {

        var business_duplicate_noti = document.getElementById('businessNumberNoti');
        if(business_duplicate_noti.className == "form-text text-success") {

            0sinessCreate !!!");
            var business_num = document.getElementById("businessNumber").value;
            var business_name = document.getElementById("businessName").value;
            var business_addr = document.getElementById("businessAddress").value;
            var business_phone = document.getElementById("businessPhone").value;
            var business_employee_arr = new Array();

            if (business_num == "" || business_name == "" || business_addr == "" || business_phone == "") {
                var alert_message = document.getElementById('empty_alert2');
                alert_message.style = "display:visible;"
                // 모달 안닫음
            } else {
                database.ref('Business/').push().set({
                    businessNumber: business_num,
                    businessName: business_name,
                    businessAddress: business_addr,
                    businessPhone: business_phone,
                    employeeList: business_employee_arr
                });

                // 새로 비즈니스를 등록했기 때문에 이 user의 직급은 Manager! - radio버튼 자동 선택
                $("input:radio[name='employee_authority']:radio[value='Manager']").prop('checked', true);
                $('#business').val(business_name);

                // 모달 닫기
                $('#newBusinessModal').modal('hide')
                alert("비즈니스 등록이 완료되었습니다.");
            }
        }else{
            alert("중복 확인을 해주세요");
        }
    };


    // 비즈니스 중복 확인
    document.getElementById('businessDuplicateButton').onclick = function() {

        var inputBusinessNum = document.getElementById("businessNumber").value.trim();
        var business_duplicate_noti = document.getElementById('businessNumberNoti');

        if(inputBusinessNum == ""){
            business_duplicate_noti.innerText = "사업자등록번호를 입력해주세요"
            business_duplicate_noti.className = "form-text text-danger"
        }else {
            var result = true;
            var dbUserRef = database.ref().child('/Business');

            dbUserRef.once("value")
                .then(function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        var childData = childSnapshot.val();
                        if (childData.businessNumber == inputBusinessNum) {
                            result = false;
                        }
                    });
                    if (result) {
                        business_duplicate_noti.innerText = "등록 가능한 사업자등록번호입니다."
                        business_duplicate_noti.className = "form-text text-success"
                    } else {
                        business_duplicate_noti.innerText = "이미 등록 되어있는 사업자등록번호입니다."
                        business_duplicate_noti.className = "form-text text-danger"
                    }

                });

        }
    }

    // 표에 비즈니스 목록 데이터 row 추가
    document.getElementById('businessSearchButton').onclick= function(){
        var count = 1;
        var dbUserRef = database.ref().child('/Business');
        $("#business_list").empty();
        dbUserRef.once("value")
            .then(function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var key = childSnapshot.key;
                    var childData = childSnapshot.val();

                    $("#business_list").append("<tr><th scope=\"row\">"+count+"</th><td>"+childData.businessNumber+"</td><td>"+childData.businessName+"</td><td>"
                        +childData.businessAddress+"</td><td><input type=\"radio\" name=\"selectBusiness\" value="+childData.businessName+"></td></tr>");
                    count++;
                });
            });
    }

    // 비즈니스 선택 버튼 클릭 시
    document.getElementById('selectAlreadyBusinessBtn').onclick= function() {

        if ($('input:radio[name="selectBusiness"]').is(':checked') == true) {
            // value를 비즈니스 name에다가 넣기
            var radioVal = $('input[name="selectBusiness"]:checked').val();
            $('#business').val(radioVal);

            // 이미 등록되어있는 비즈니스를 선택한 것이므로 이 user의 직급은 staff! - radio버튼 자동 선택
            $("input:radio[name='employee_authority']:radio[value='Staff']").prop('checked', true);

            // 모달 닫기
            $('#searchBusinessModal').modal('hide')
        }else{
            alert("회사를 선택해주세요");
        }

    }


</script>



</body>
</html>