<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome!</title>
    <link rel="stylesheet" href="css/bootstrap.css"> <!-- 부트스트랩에서 제공하는 css파일을 이용하겠다-->
</head>
<body>
<!--계정-->
<!-- - User1 : id / password / 이름 / email / 업체 / 매니저인지아닌지 / 승인여부-->

<body class="bg-gradient-primary">

<div class="container">

    <!-- Outer Row -->
    <div class="row justify-content-center">

        <div class="col-lg-6 col-md-8 col-md-12 align-self-center">

            <div class="card o-hidden border-0 shadow-lg my-5">
                <div class="card-body p-0">
                    <!-- Nested Row within Card Body -->
                    <div class="row justify-content-center">
                        <div class="col-md-12">
                            <div class="p-5">
                                <div class="text-center">
                                    <h1 class="h4 text-gray-900 mb-4">Create Account!</h1>
                                </div>
                                <form class="user">
                                    <div class="form-group">
                                        Name
                                        <input type="text" class="form-control form-control-user" id="name">
                                    </div>
                                    <a>ID</a><br>
                                    <div class="form-group row">

                                        <div class="col-sm-8">
                                            <input type="text" class ="form-control form-control-user" id="id">
                                        </div>
                                        <div class="col-sm-4">
                                            <a class="btn btn-secondary text-white btn-user btn-sm" id="duplicateButton">Duplicate Check</a>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div class="col-sm-6 mb-3 mb-sm-0">
                                            Password
                                            <input type="password" class="form-control form-control-user" id="password1">
                                        </div>
                                        <div class="col-sm-6">
                                            Password Again
                                            <input type="password" class="form-control form-control-user" id="password2">
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        Email
                                        <input type="email" class="form-control form-control-user" id="email" >
                                    </div>

                                    <div class="form-group">
                                        <a>Business name</a>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <input type="text" class ="form-control form-control-user" id="business" readonly>
                                            </div>
                                            <div class="col-3">
                                                <a class="btn btn-secondary text-white btn-user btn-sm" style="width:100%" id="businessSearchButton" data-toggle="modal" data-target="#searchBusinessModal" >Search</a>
                                            </div>
                                            <div class="col-3">
                                                <a class="btn btn-info text-white btn-user btn-sm" style="width:100%" id="businessRegisterButton" data-toggle="modal" data-target="#newBusinessModal" >New</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group align-self-end">
                                        <input type="radio" id="male" name="employee_authority" value="Manager" onclick="return(false);">
                                        <label>Manager</label> &nbsp;&nbsp;&nbsp;
                                        <input type="radio" id="female" name="employee_authority" value="Staff" onclick="return(false);">
                                        <label>Staff</label><br>
                                    </div>

                                    <!--// 모든 입력창을 다 입력해달라는 경고창 -->
                                    <div id="empty_alert" style="display:none;" class="alert alert-danger">
                                        Please enter all information!
                                    </div>

                                    <a class="btn btn-primary text-white btn-user btn-block " id="createAccountButton">
                                        Create Account
                                    </a>
                                    <hr>
                                </form>

                                <div class="text-center">
                                    <a href ="index.html" class="small" href="register.html">Already have account? Login!</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--업체정보-->
<!-- - 업체 A : 업체명 / 사업자등록번호 / 주소지 / 대표전화 / 직원리스트(uid)-->

<!-- 이미 등록된 회사가 있는지 검색리스트 보여주는 모달-->
<div class="modal fade" id="searchBusinessModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content align-self-center">
            <div class="modal-header">
                <h6 class="modal-title" id="searchBusinessModalLabel">Result of Search</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body ">
                <table class="table table-sm">
                    <thead class="thead-light ">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">사업자등록번호</th>
                        <th scope="col">회사명</th>
                        <th scope="col">회사주소</th>
                        <th scope="col">선택</th>
                    </tr>
                    </thead>
                    <tbody id="business_list">

                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="selectAlreadyBusinessBtn">Select</button>
            </div>
        </div>
    </div>
</div>

<!--새로운 회사 등록하는 모달-->
<div class="modal fade" id="newBusinessModal" tabindex="-1" role="dialog" >
    <div class="modal-dialog modal-dialog-centered " role="document">
        <div class="modal-content align-self-center">
            <div class="modal-header">
                <h6 class="modal-title" id="newBusinessModalLabel">New Business Registration</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Business Number
                <div class="form-group row">
                    <div class="col-8">
                        <input type="text" class ="form-control form-control-user" id="businessNumber">
                        <small id="businessNumberNoti" class="form-text text-danger">중복 확인을 해주세요</small>
                    </div>
                    <div class="col-4">
                        <a class="btn btn-secondary text-white btn-user btn-sm" id="businessDuplicateButton">Duplicate Check</a>
                    </div>

                </div>

                <div class="form-group">
                    Business Name
                    <input type="text" class="form-control form-control-user" id="businessName" >
                </div>
                <div class="form-group">
                    Business Address
                    <input type="text" class="form-control form-control-user" id="businessAddress">
                </div>
                <div class="form-group">
                    Phone Number
                    <input type="text" class="form-control form-control-user" id="businessPhone">
                </div>
            </div>
            <!--// 모든 입력창을 다 입력해달라는 경고창 -->
            <div id="empty_alert2" style="display:none;" class="alert alert-danger">
                Please enter all information!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="newBusinessCreate">Register</button>
            </div>
        </div>
    </div>
</div>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src='js/bootstrap.js'></script>

<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>

<script>



    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyAJHIyMYLbLaou3TC9Jxu7bCrvY9mvA5v8",
        authDomain: "inventorysystem-7f9cb.firebaseapp.com",
        databaseURL: "https://inventorysystem-7f9cb.firebaseio.com",
        projectId: "inventorysystem-7f9cb",
        storageBucket: "inventorysystem-7f9cb.appspot.com",
        messagingSenderId: "301963214438",
        appId: "1:301963214438:web:d6db327dab10860852b7a7",
        measurementId: "G-568LQ0P1QB"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    var database = firebase.database();
    var auth = firebase.auth();
</script>

<script>

    // 계정 생성 버튼 클릭 시
    document.getElementById('createAccountButton').onclick = function () {
        console.log("Here is createAccountButton !!!");
        var name = document.getElementById("name").value.trim();
        var id = document.getElementById("id").value.trim();
        var password = document.getElementById("password2").value.trim();
        var email = document.getElementById("email").value.trim();
        var business = document.getElementById("business").value.trim();


        if(name == "" || id == "" || password == "" || email == ""|| business == ""){
            var alert = document.getElementById('empty_alert');
            alert.style= "display:visible;"

        }else{
            database.ref('User/').push().set({
                name : name,
                id : id,
                password : password,
                email : email,
                business : business,
                authority : "Manager",
                Approval : true
            });

        }
    };

    // 새로운 비즈니스 등록 버튼 클릭 시
    document.getElementById('newBusinessCreate').onclick = function () {

        console.log("Here is newBusinessCreate !!!");
        var business_num = document.getElementById("businessNumber").value;
        var business_name = document.getElementById("businessName").value;
        var business_addr = document.getElementById("businessAddress").value;
        var business_phone = document.getElementById("businessPhone").value;
        var business_employee_arr = new Array();

        if(business_num == "" || business_name == "" || business_addr == "" || business_phone == ""){
            var alert = document.getElementById('empty_alert2');
            alert.style= "display:visible;"
            // 모달 안닫음
        }else{
            database.ref('Business/').push().set({
                businessNumber : business_num,
                businessName : business_name,
                businessAddress : business_addr,
                businessPhone : business_phone,
                employeeList : business_employee_arr
            });

            // 새로 비즈니스를 등록했기 때문에 이 user의 직급은 Manager! - radio버튼 자동 선택
            $("input:radio[name='employee_authority']:radio[value='Manager']").prop('checked', true);

            // 모달 닫기
            $('#newBusinessModal').modal('hide')
        }
    };


    // 비즈니스 중복 확인 후
    document.getElementById('businessDuplicateButton').onclick = function() {

        var inputBusinessNum = document.getElementById("businessNumber").value.trim();
        var business_duplicate_noti = document.getElementById('businessNumberNoti');

        if(inputBusinessNum == ""){
            business_duplicate_noti.innerText = "사업자등록번호를 입력해주세요"
            business_duplicate_noti.className = "form-text text-danger"
        }else {
            var result = true;
            var dbUserRef = database.ref().child('/Business');

            dbUserRef.once("value")
                .then(function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        var childData = childSnapshot.val();
                        console.log("data--->"+inputBusinessNum+" / "+childData.businessNumber);
                        if (childData.businessNumber == inputBusinessNum) {
                            console.log("data2--->"+inputBusinessNum+" / "+childData.businessNumber);
                            result = false;
                        }
                    });
                    if (result) {
                        business_duplicate_noti.innerText = "등록 가능한 사업자등록번호입니다."
                        business_duplicate_noti.className = "form-text text-success"
                    } else {
                        business_duplicate_noti.innerText = "이미 등록 되어있는 사업자등록번호입니다."
                        business_duplicate_noti.className = "form-text text-danger"
                    }

                });

        }
    }

    // 표에 비즈니스 목록 데이터 row 추가
    document.getElementById('businessSearchButton').onclick= function(){
        var count = 1;
        var dbUserRef = database.ref().child('/Business');

        dbUserRef.once("value")
            .then(function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var key = childSnapshot.key;
                    var childData = childSnapshot.val();

                    $("#business_list").append("<tr><th scope=\"row\">"+count+"</th><td>"+childData.businessNumber+"</td><td>"+childData.businessName+"</td><td>"
                        +childData.businessAddress+"</td><td><input type=\"radio\" name=\"selectBusiness\" value="+childData.businessName+"></td></tr>");
                    count++;
                });
            });
    }

    // 비즈니스 선택 버튼 클릭 시
    document.getElementById('selectAlreadyBusinessBtn').onclick= function() {

        if ($('input:radio[name="selectBusiness"]').is(':checked') == true) {
            // value를 비즈니스 name에다가 넣기
            var radioVal = $('input[name="selectBusiness"]:checked').val();
            $('#business').val(radioVal);

            // 이미 등록되어있는 비즈니스를 선택한 것이므로 이 user의 직급은 staff! - radio버튼 자동 선택
            $("input:radio[name='employee_authority']:radio[value='Staff']").prop('checked', true);

            // 모달 닫기
            $('#searchBusinessModal').modal('hide')
        }else{
            alert("회사를 선택해주세요")
        }
    }


</script>



</body>
</html>