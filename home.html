
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

  <title>Home</title>

  <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/dashboard/">
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <link href="css/templete1.css" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
  <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#"><center>Inventory System</center></a>
  <ul class="navbar-nav px-3 mr-auto"></ul>
  <ul class="navbar-nav px-3 ">
    <li class="nav-item text-nowrap">
      <a class="text-light nav-link" id="user_name" ><span data-feather="user"></span>&nbsp;&nbsp;홍길동 님</a>
    </li>
  </ul>
  <ul class="navbar-nav px-3">
    <li class="nav-item text-nowrap">
      <a class="text-light nav-link" href="#"><span data-feather="log-out"></span>&nbsp;&nbsp;Sign out</a>
    </li>
  </ul>
</nav>

<div class="container-fluid">
  <div class="row">
    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
      <div class="sidebar-sticky">

        <ul class="nav list-group flex-column">
          <li class="nav-item list-group-item">
            <a class="nav-link active"  data-toggle="tab" href="#p1">
              <span data-feather="shopping-cart"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Products
            </a>
          </li>

          <li class="nav-item list-group-item">
            <a class="nav-link" id="approval_menu" data-toggle="tab" href="#p3">
              <span data-feather="layers"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Approval
            </a>
          </li>
          <li class="nav-item list-group-item">
            <a class="nav-link" data-toggle="tab" href="#p2">
              <span data-feather="bar-chart-2"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Reports
            </a>
          </li>

        </ul>
      </div>
    </nav>
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
      <div class="tab-content">
        <div class="tab-pane fade show active" id="p1">
          <h5>Product</h5>
          <div class="container-fluid bgGreyLighten2">
            <div class="form-group row align-items-center ">
              <div class="col-2">
                Product number
                <input type="text" class="form-control form-control-user form-control-sm" id="search_productNum">
              </div>
              <div class="col-2">
                Product name
                <input type="text" class="form-control form-control-user form-control-sm" id="search_productName">
              </div>
              <div class="col-2">
                Barcode number
                <input type="text" class="form-control form-control-user form-control-sm" id="search_barcode">
              </div >
              <div class="col-1">
                <a class="btn btn-secondary text-white btn-user btn-sm m-3" id="searchBtn">Search</a>
              </div>
              <div class="col-3">
              </div>
              <div class="col align-self-end">
                <a class="btn btn-info text-white btn-user btn-sm m-3" id="newProduct" data-toggle="modal" data-target="#newProductModal">New Product</a>
              </div>
            </div>
          </div>

<!--          <form class="product">-->
<!--            <div class="form-group row">-->
<!--              <div class="col-7">-->
<!--                <input type="text" class="col-3 form-control form-control-user m-2" id="searchInput">-->
<!--                <a class="col-1 btn btn-secondary text-white btn-user btn-smm-2" id="searchBtn">Search</a>-->
<!--                <a class="col-1 btn btn-info text-white btn-user btn-smm-2" id="newProduct" data-toggle="modal" data-target="#newProductModal">New</a>-->
<!--              </div>-->
<!--            </div>-->
<!--          </form>-->

          <center>
            <table class="table " style="width: 100%;">
              <thead class="thead-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">상품 번호</th>
                <th scope="col">상품명</th>
                <th scope="col">색상</th>
                <th scope="col">사이즈</th>
                <th scope="col">바코드번호</th>
                <th scope="col">수량</th>
              </tr>
              </thead>
              <tbody id="product_list">
              </tbody>
            </table>
          </center>

          <!--New 버튼 클릭시-->
          <div class="modal fade" id="newProductModal" tabindex="-1" role="dialog" >
            <div class="modal-dialog modal-dialog-centered " role="document">
              <div class="modal-content align-self-center">
                <div class="modal-header">
                  <h6 class="modal-title" id="newProductModalLabel">Product Registration</h6>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  *Product Code (자유롭게 입력 가능합니다.)
                  <div class="form-group row">
                    <div class="col-8">
                      <input type="text" class ="form-control form-control-user" id="productCodeNew">
                      <small id="productCodeNoti" class="form-text text-danger">중복 확인을 해주세요</small>
                    </div>
                    <div class="col-4">
                      <a class="btn btn-secondary text-white btn-user btn-sm" id="codeduplicateButton">Duplicate Check</a>
                    </div>
                  </div>
                  <div class="form-group">
                    *Product Name
                    <input type="text" class="form-control form-control-user" id="productNameNew">
                  </div>
                  <div class="form-group">
                    *Stock
                    <input type="integer" class="form-control form-control-user" id="productStockNew">
                  </div>
                  <div class="form-group">
                    *Barcode Number
                    <input type="text" class="form-control form-control-user" id="productBarcodeNew">
                  </div>
                  (Optional)
                  <div class="form-group">
                    Size
                    <input type="text" class="form-control form-control-user" id="productSizeNew" >
                  </div>
                  <div class="form-group">
                    Color
                    <input type="text" class="form-control form-control-user" id="productColorNew">
                  </div>
                </div>

                <!--// 모든 입력창을 다 입력해달라는 경고창 -->
                <div id="empty_alert2" style="display:none;" class="alert alert-danger">
                  Please enter every * information!
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="newProductButton">Register</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="p2">
          <h5>Report</h5>
          <div>
            <div class="animated fadeIn">

              <div class="col-9 grid-margin" style=margin:auto;>
                <div class="card">
                  <div class="card-body">
                    <h6 class="card-title"><b>Today's inventory status</b></h6>
                    <canvas id="barChart"></canvas>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-lg-6 grid-margin grid-margin-lg-0 stretch-card">
                  <div class="card">
                    <div class="card-body">
                      <h6 class="card-title"><b>Monthly</b><br><b>Inventory History</b></h6>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                      <select dir="rtl" name="select1" id="monthlyProductSelector" onchange="onChangeMonthlySelector(this.value);" >
                      </select>

                      <div id="div1" width="300" height="200" style="display:none;">
                        div1
                      </div>
                      <div id="div2" width="300" height="200" style="display:none;">
                        div2
                      </div>
                      <div id="div3" width="300" height="200" style="display:none;">
                        div3
                      </div>

                      <canvas id="lineChart1"></canvas>
                    </div>

                  </div>
                </div>


                <div class="col-lg-6 grid-margin grid-margin-lg-0 stretch-card">
                  <div class="card">
                    <div class="card-body">
                      <h6 class="card-title">
                        <b>June Weekly</b> <br>
                        <b>Inventory History </b></h6>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                      <select dir="rtl" name="select1" id="weeklyProductSelector" onchange="onChangeWeeklySelector(this.value);" >
                      </select>

                      <div id="div1" width="300" height="200" style="display:none;">
                        div1
                      </div>
                      <div id="div2" width="300" height="200" style="display:none;">
                        div2
                      </div>
                      <div id="div3" width="300" height="200" style="display:none;">
                        div3
                      </div>
                      <canvas id="lineChart2"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            </div>
        </div>
        <div class="tab-pane fade" id="p3">
          <h5>Approval</h5>
          <center>
            <table class="table " style="width: 100%;">
              <thead class="thead-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">직원 이름</th>
                <th scope="col">회사명</th>
                <th scope="col">아이디</th>
                <th scope="col">이메일</th>
                <th scope="col">승인 상태</th>
                <th scope="col">변경</th>
              </tr>
              </thead>
              <tbody id="staff_list">

              </tbody>
            </table>
          </center>
        </div>

      </div>

    </main>
  </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script>
  feather.replace()
</script>

<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>
<script>

  function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }



</script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyAJHIyMYLbLaou3TC9Jxu7bCrvY9mvA5v8",
    authDomain: "inventorysystem-7f9cb.firebaseapp.com",
    databaseURL: "https://inventorysystem-7f9cb.firebaseio.com",
    projectId: "inventorysystem-7f9cb",
    storageBucket: "inventorysystem-7f9cb.appspot.com",
    messagingSenderId: "301963214438",
    appId: "1:301963214438:web:d6db327dab10860852b7a7",
    measurementId: "G-568LQ0P1QB"
  };
  firebase.initializeApp(firebaseConfig);
  var database = firebase.database();


  var param_userkey = getParameterByName('userKey');
  var user_info = null;
  var dbUserRef = database.ref().child('/User');

  dbUserRef.once("value")
      .then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          if (childSnapshot.key == param_userkey) {
            user_info = childSnapshot.val();
            console.log(user_info);
            loadApprovalData();

            $("#user_name").text(user_info.name+" 님");
          }
        });
      });


  function loadApprovalData(){
    var count = 1;
    // var my_business_name = "스트벅스";
    var my_business_name = user_info.business;
    $("#staff_list").empty();

    var dbUserRef = database.ref().child('/User');
    dbUserRef.once("value")
      .then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          var childData = childSnapshot.val();
          var tmp_id = "r"+count

          console.log(childData);

          if(childData.business == my_business_name && childData.authority == "Staff" && childData.approval ==false) {

            $("#staff_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.name + "</td><td>" + childData.business + "</td><td>" + childData.id + "</td><td>" + childData.email + "</td><td>"
                    + "승인 대기" + "</td><td><input type=\"button\" class = \"btn btn-danger btn-sm\" value=\"승인하기\" name=\"approve_staff\" id="+tmp_id+"></td></tr>");

            document.getElementById(tmp_id).onclick= function() {
              if(user_info.authority == "Manager"){
                var checkBtn = $(this);
                var tr = checkBtn.parent().parent();
                var td = tr.children();
                var id = td.eq(3).text();
                changeApprovalState(id)
              }else{
                alert("권한이 없습니다.")
              }

            }
            count++;
          }else if(childData.business == my_business_name && childData.authority == "Staff" && childData.approval ==true){
            $("#staff_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.name + "</td><td>" + childData.business + "</td><td>" + childData.id + "</td><td>" + childData.email + "</td><td>"
                    + "승인 완료" + "</td><td><input type=\"button\" class = \"btn btn-success btn-sm\" value=\"승인완료\" name=\"approve_staff\" id="+tmp_id+"></td></tr>");
            // document.getElementById(tmp_id).onclick= function() {
            //   var checkBtn = $(this);
            //   var tr = checkBtn.parent().parent();
            //   var td = tr.children();
            //   var id = td.eq(3).text();
            //   changeApprovalState(id)
            // }
            count++;
          }

        });
      });
  }

  function changeApprovalState(user_id){
    var count = 1;

    var dbUserRef = database.ref().child('/User');

    dbUserRef.once("value")
      .then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          var childData = childSnapshot.val();
          if(childData.id ==user_id){
            childData.approval = true;
            database.ref('User/' + childSnapshot.key+'/').set(childData);
            alert("승인되었습니다.")
            loadApprovalData();
          }
        });
      });
  }
</script>

<!--상품 페이지-->
<script type="text/javascript">
  // search 버튼 클릭시
  document.getElementById('searchBtn').onclick = function () {

    var search_what = 0;

    var search_productNum = document.getElementById("search_productNum").value.trim();
    var search_productName = document.getElementById("search_productName").value.trim();
    var search_productBarcode = document.getElementById("search_barcode").value.trim();

    if(search_productNum!=""){
      search_what = 1;
    }else if(search_productName!=""){
      search_what = 2;
    }else if(search_productBarcode!=""){
      search_what = 3;
    }
    console.log("option ---->", search_what);

    var count = 1;
    // var my_business_name = "스트벅스";
    // var my_business_name = user_info.business;
    $("#product_list").empty();

    if(search_what == 0){
      loadProductData()
    }else {
      var dbUserRef = database.ref().child('/prod');
      dbUserRef.once("value")
        .then(function (snapshot) {
          snapshot.forEach(function (childSnapshot) {
            var childData = childSnapshot.val();
            var tmp_id = "rp" + count

            if (childData.business == user_info.business) { // 내 회사꺼 + 찾고자하는 product code인 경우
              switch (search_what) {
                case 1:
                  if (childData.productCode == search_productNum) {
                    $("#product_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.productCode + "</td><td>" + childData.productName + "</td><td>" + childData.color + "</td><td>" + childData.size + "</td><td>"
                            + childData.barcode + "</th><td>"
                            + "<input type=\"number\" id = \"" + (tmp_id + "n") + "\" value=\"" + childData.stock + "\"/>"
                            + "<input type=\"button\" class = \"btn btn-primary btn-sm ml-3\" value=\"저장\" name=\"product_num\" id=\"" + tmp_id + "\"></td>");


                    document.getElementById(tmp_id).onclick = function () {
                      var checkBtn = $(this);
                      var tr = checkBtn.parent().parent();
                      var td = tr.children();
                      var product_code = td.eq(1).text();
                      var tmp = tmp_id + "n";
                      var product_final_num = document.getElementById(tmp).value;
                      changeProductNum(product_code, product_final_num - childData.stock);
                    }

                    console.log("Product Data-->", childData);
                    count++;
                  }
                  break;
                case 2:
                  if (childData.productName == search_productName) {
                    $("#product_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.productCode + "</td><td>" + childData.productName + "</td><td>" + childData.color + "</td><td>" + childData.size + "</td><td>"
                            + childData.barcode + "</th><td>"
                            + "<input type=\"number\" id = \"" + (tmp_id + "n") + "\" value=\"" + childData.stock + "\"/>"
                            + "<input type=\"button\" class = \"btn btn-primary btn-sm ml-3\" value=\"저장\" name=\"product_num\" id=\"" + tmp_id + "\"></td>");


                    document.getElementById(tmp_id).onclick = function () {
                      var checkBtn = $(this);
                      var tr = checkBtn.parent().parent();
                      var td = tr.children();
                      var product_code = td.eq(1).text();
                      var tmp = tmp_id + "n";
                      var product_final_num = document.getElementById(tmp).value;
                      changeProductNum(product_code, product_final_num - childData.stock);
                    }

                    console.log("Product Data-->", childData);
                    count++;
                  }
                  break;
                case 3:
                  if (childData.barcode == search_productBarcode) {
                    $("#product_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.productCode + "</td><td>" + childData.productName + "</td><td>" + childData.color + "</td><td>" + childData.size + "</td><td>"
                            + childData.barcode + "</th><td>"
                            + "<input type=\"number\" id = \"" + (tmp_id + "n") + "\" value=\"" + childData.stock + "\"/>"
                            + "<input type=\"button\" class = \"btn btn-primary btn-sm ml-3\" value=\"저장\" name=\"product_num\" id=\"" + tmp_id + "\"></td>");


                    document.getElementById(tmp_id).onclick = function () {
                      var checkBtn = $(this);
                      var tr = checkBtn.parent().parent();
                      var td = tr.children();
                      var product_code = td.eq(1).text();
                      var tmp = tmp_id + "n";
                      var product_final_num = document.getElementById(tmp).value;
                      changeProductNum(product_code, product_final_num - childData.stock);
                    }

                    console.log("Product Data-->", childData);
                    count++;
                  }
                  break;

              }


            }
          });
        });
    }

  }


  // new 버튼 클릭시
  document.getElementById('newProductButton').onclick = function () {

    var account_duplicate_noti = document.getElementById('productCodeNoti');

    if(account_duplicate_noti.className == "form-text text-success") {

      console.log("Here is createProductButton !!!");
      var business = user_info.business;
      var productCode = document.getElementById("productCodeNew").value.trim();
      var productName = document.getElementById("productNameNew").value.trim();
      var size = document.getElementById("productSizeNew").value.trim();
      var color = document.getElementById("productColorNew").value.trim();
      var stock = document.getElementById("productStockNew").value.trim();
      var barcode = document.getElementById("productBarcodeNew").value.trim();
      var history = new Array();

      var today  = getTimeStamp();
      history.push(today + "/0");

      if (productCode == "" || productName == "" || stock == "" || barcode == "") {
        var alert_message = document.getElementById('empty_alert');
        alert_message.style = "display:visible;"

      } else {
        database.ref('prod/').child(productCode).set({
          business : user_info.business,
          productCode: productCode,
          productName: productName,
          size: size,
          color: color,
          stock: stock,
          barcode: barcode,
          history: history
        });

        $('#newProductModal').modal('hide')
        location.reload(true);
        alert("등록이 완료되었습니다.");
      }
    } else{
      alert("제품코드 중복확인을 해주세요.");
    }
  };


  // 제품코드 중복확인
  document.getElementById('codeduplicateButton').onclick = function () {

    var inputProdCode = document.getElementById("productCodeNew").value.trim();
    var code_duplicate_noti = document.getElementById('productCodeNoti');

    if(inputProdCode == ""){
      code_duplicate_noti.innerText = "제품 판별코드를 입력하세요."
      code_duplicate_noti.className = "form-text text-danger"
    }else {
      var result = true;
      var dbProdRef = database.ref().child('/prod');

      dbProdRef.once("value")
              .then(function (snapshot) {
                snapshot.forEach(function (childSnapshot) {
                  var childData = childSnapshot.val();
                  if (childData.productCode == inputProdCode) {
                    result = false;
                  }
                });
                if (result) {
                  code_duplicate_noti.innerText = "사용 가능한 제품 코드입니다."
                  code_duplicate_noti.className = "form-text text-success"
                } else {
                  code_duplicate_noti.innerText = "사용 불가능한 제품 코드입니다."
                  code_duplicate_noti.className = "form-text text-danger"
                }

              });

    }

  }
  function getTimeStamp() {

    var d = new Date();
    var s =
            leadingZeros(d.getFullYear(), 4) + '-' +
            leadingZeros(d.getMonth() + 1, 2) + '-' +
            leadingZeros(d.getDate(), 2);

    return s;
  }
  function leadingZeros(n, digits) {

    var zero = '';
    n = n.toString();

    if (n.length < digits) {
      for (i = 0; i < digits - n.length; i++)
        zero += '0';
    }
    return zero + n;
  }

  function loadProductData(){
    var count = 1;
    // var my_business_name = "스트벅스";
    // var my_business_name = user_info.business;
    $("#product_list").empty();

    var dbUserRef = database.ref().child('/prod');
    dbUserRef.once("value")
      .then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          var childData = childSnapshot.val();
          var tmp_id = "rp"+count

          if(childData.business == user_info.business) { // 내 회사꺼만

            $("#product_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.productCode + "</td><td>" + childData.productName + "</td><td>" + childData.color + "</td><td>" + childData.size + "</td><td>"
                    + childData.barcode + "</th><td>"
                    // + "<input type=\"button\" class = \"btn btn-light btn-sm m-1\" value=\"-\" name=\"approve_staff\" id="+(tmp_id+"-")+">"
                    + "<input type=\"number\" id = \""+(tmp_id+"n")+"\" value=\"" + childData.stock + "\"/>"
                    // + "<input type=\"button\" class = \"btn btn-light btn-sm m-1\" value=\"+\" name=\"approve_staff\" id="+(tmp_id+"+")+">"
                    + "<input type=\"button\" class = \"btn btn-primary btn-sm ml-3\" value=\"저장\" name=\"product_num\" id=\"" + tmp_id+ "\"></td>");


            document.getElementById(tmp_id).onclick= function() {
              var checkBtn = $(this);
              var tr = checkBtn.parent().parent();
              var td = tr.children();
              var product_code = td.eq(1).text();
              var tmp = tmp_id+"n";
              var product_final_num = document.getElementById(tmp).value;
              changeProductNum(product_code, product_final_num-childData.stock);
            }

            console.log("Product Data-->", childData);
            count++;
          }
        });
      });
  }
  loadProductData();


  function changeProductNum(product_code, num){
    var count = 1;
    num *= 1;

    var dbUserRef = database.ref().child('/prod');

    dbUserRef.once("value")
      .then(function(snapshot) {
        snapshot.forEach(function(childSnapshot) {
          var childData = childSnapshot.val();
          if(childData.productCode ==product_code){
            var tmp_stock = childData.stock*1;
            childData.stock = tmp_stock + num;
            var today = getTimeStamp();
            if(childData.history != null) {
              var history = childData.history;
              history.push(today + "/" + num);
            }else{
              var history = new Array();
              history.push(today + "/" + num);
            }
            childData.history=history;
            database.ref('prod/' + childSnapshot.key+'/').set(childData);
            alert("재고 수량이 변경되었습니다.")
            loadProductData();
          }
        });
      });
  }



</script>
<script>
  // var firebaseConfig = {
  //   apiKey: "AIzaSyAJHIyMYLbLaou3TC9Jxu7bCrvY9mvA5v8",
  //   authDomain: "inventorysystem-7f9cb.firebaseapp.com",
  //   databaseURL: "https://inventorysystem-7f9cb.firebaseio.com",
  //   projectId: "inventorysystem-7f9cb",
  //   storageBucket: "inventorysystem-7f9cb.appspot.com",
  //   messagingSenderId: "301963214438",
  //   appId: "1:301963214438:web:d6db327dab10860852b7a7",
  //   measurementId: "G-568LQ0P1QB"
  // };
  // // Initialize Firebase
  // firebase.initializeApp(firebaseConfig);
  // // firebase.analytics();
  // const db = firebase.database()
  var products = []


  database.ref("prod").on('value', function(querySnapshot) {
    products = Object.values(querySnapshot.val())
    products.forEach((product, index) => {
      product['monthlyStocks'] = {
        'April': 0,
        'May': 0,
        'June': 0,
      }
      product['weeklyStocks'] = {
        '1st week': 0,
        '2nd week': 0,
        '3rd week': 0,
        '4th week': 0,
      }

      // 월별 히스토리
      product.history.forEach((h) => {
        let date = h.split('/')[0]
        let count = Number(h.split('/')[1])
        if(date.includes("2020-04")) {
          product.monthlyStocks['April'] += count
        } else if(date.includes("2020-05")) {
          product.monthlyStocks['May'] += count
        } else {
          product.monthlyStocks['June'] += count
          let day = Number(date.substring(8,10))
          if(day >= 1 && day <=7) {
            product.weeklyStocks['1st week'] += count
          } else if(day >= 8 && day <=14) {
            product.weeklyStocks['2nd week'] += count
          } else if(day >= 15 && day <=21) {
            product.weeklyStocks['3rd week'] += count
          } else {
            product.weeklyStocks['4th week'] += count
          }
        }
      })

      if($("#monthlyProductSelector > option").get().length < products.length) {
        $("#monthlyProductSelector").append(new Option(product.productName, index))
      }
      if($("#monthlyProductSelector > option").get().length < products.length) {
        $("#weeklyProductSelector").append(new Option(product.productName, index))
      }

      return product
    })
    let names = products.map((product) => product.productName)
    let stocks = products.map((product) => product.stock)

    updateBarChart(names, stocks)
    updateMonthlyChart(products[0].monthlyStocks)
    updateWeeklyChart(products[0].weeklyStocks)
  });

  function onChangeMonthlySelector(productIndex){
    updateMonthlyChart(products[productIndex].monthlyStocks)
  }
  function onChangeWeeklySelector(productIndex){
    updateWeeklyChart(products[productIndex].weeklyStocks)
  }


</script>
<script src="vendors/base/vendor.bundle.base.js"></script>
<script src="vendors/chart.js/Chart.min.js"></script>
<script src="js/off-canvas.js"></script>
<script src="js/chart.js"></script>
<script src="js/off-canvas.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-match-height@0.7.2/dist/jquery.matchHeight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.3/dist/Chart.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery.flot@0.8.3/jquery.flot.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flot-spline@0.0.1/js/jquery.flot.spline.min.js"></script>
</body>
</html>
