@@ -0,0 +1,246 @@

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

  <title>Home</title>

  <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/dashboard/">
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <link href="css/templete1.css" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
  <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#"><center>Inventory System</center></a>
  <ul class="navbar-nav px-3 mr-auto"></ul>
  <ul class="navbar-nav px-3 ">
    <li class="nav-item text-nowrap">
      <a class="text-light nav-link" id="user_name" ><span data-feather="user"></span>&nbsp;&nbsp;양희림 님</a>
    </li>
  </ul>
  <ul class="navbar-nav px-3">
    <li class="nav-item text-nowrap">
      <a class="text-light nav-link" href="#"><span data-feather="log-out"></span>&nbsp;&nbsp;Sign out</a>
    </li>
  </ul>
</nav>

<div class="container-fluid">
  <div class="row">
    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
      <div class="sidebar-sticky">

        <ul class="nav list-group flex-column">
          <li class="nav-item list-group-item">
            <a class="nav-link active"  data-toggle="tab" href="#p1">
              <span data-feather="shopping-cart"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Products
            </a>
          </li>
          <li class="nav-item list-group-item">
            <a class="nav-link" data-toggle="tab" href="#p2">
              <span data-feather="bar-chart-2"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Reports
            </a>
          </li>
          <li class="nav-item list-group-item">
            <a class="nav-link" id="approval_menu" data-toggle="tab" href="#p3">
              <span data-feather="layers"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Approval
            </a>
          </li>
          <li class="nav-item list-group-item">
            <a class="nav-link" data-toggle="tab" href="#p4">
              <span data-feather="settings"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;Settings
            </a>
          </li>
          <li class="nav-item list-group-item">
            <a class="nav-link" data-toggle="tab" href="#p5">
              <span data-feather="user"></span>
              &nbsp;&nbsp;&nbsp;&nbsp;My Page
            </a>
          </li>
        </ul>
      </div>
    </nav>
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
      <div class="tab-content">
        <div class="tab-pane fade show active" id="p1">
          <h5>Product</h5>
        </div>
        <div class="tab-pane fade" id="p2">
          <h5>Report</h5>
        </div>
        <div class="tab-pane fade" id="p3">
          <h5>Approval</h5>
          <center>
            <table class="table " style="width: 100%;">
              <thead class="thead-light ">
              <tr>
                <th scope="col">#</th>
                <th scope="col">직원 이름</th>
                <th scope="col">회사명</th>
                <th scope="col">아이디</th>
                <th scope="col">이메일</th>
                <th scope="col">승인 상태</th>
                <th scope="col">변경</th>
              </tr>
              </thead>
              <tbody id="staff_list">

              </tbody>
            </table>
          </center>
        </div>
        <div class="tab-pane fade" id="p4">
          <h5>Setting</h5>
        </div>
        <div class="tab-pane fade" id="p5" >
          <h5>My Page</h5>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script>
  feather.replace()
</script>

<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.0/firebase-database.js"></script>
<script>

  function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }



</script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyAJHIyMYLbLaou3TC9Jxu7bCrvY9mvA5v8",
    authDomain: "inventorysystem-7f9cb.firebaseapp.com",
    databaseURL: "https://inventorysystem-7f9cb.firebaseio.com",
    projectId: "inventorysystem-7f9cb",
    storageBucket: "inventorysystem-7f9cb.appspot.com",
    messagingSenderId: "301963214438",
    appId: "1:301963214438:web:d6db327dab10860852b7a7",
    measurementId: "G-568LQ0P1QB"
  };
  firebase.initializeApp(firebaseConfig);
  var database = firebase.database();


  var param_userkey = getParameterByName('userKey');
  var user_info = null;
  var dbUserRef = database.ref().child('/User');

  dbUserRef.once("value")
          .then(function(snapshot) {
            snapshot.forEach(function(childSnapshot) {
              if (childSnapshot.key == param_userkey) {
                user_info = childSnapshot.val();
                console.log(user_info);
                loadApprovalData();

                $("#user_name").text(user_info.name+" 님");
              }
            });
          });


  function loadApprovalData(){
    var count = 1;
    // var my_business_name = "스트벅스";
    var my_business_name = user_info.business;
    $("#staff_list").empty();

    var dbUserRef = database.ref().child('/User');
    dbUserRef.once("value")
            .then(function(snapshot) {
              snapshot.forEach(function(childSnapshot) {
                var childData = childSnapshot.val();
                var tmp_id = "r"+count

                console.log(childData);

                if(childData.business == my_business_name && childData.authority == "Staff" && childData.approval ==false) {

                  $("#staff_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.name + "</td><td>" + childData.business + "</td><td>" + childData.id + "</td><td>" + childData.email + "</td><td>"
                          + "승인 대기" + "</td><td><input type=\"button\" class = \"btn btn-danger btn-sm\" value=\"승인하기\" name=\"approve_staff\" id="+tmp_id+"></td></tr>");

                  document.getElementById(tmp_id).onclick= function() {
                    var checkBtn = $(this);
                    var tr = checkBtn.parent().parent();
                    var td = tr.children();
                    var id = td.eq(3).text();
                    changeApprovalState(id)
                  }
                  count++;
                }else if(childData.business == my_business_name && childData.authority == "Staff" && childData.approval ==true){
                  $("#staff_list").append("<tr><th scope=\"row\">" + count + "</th><td>" + childData.name + "</td><td>" + childData.business + "</td><td>" + childData.id + "</td><td>" + childData.email + "</td><td>"
                          + "승인 완료" + "</td><td><input type=\"button\" class = \"btn btn-success btn-sm\" value=\"승인완료\" name=\"approve_staff\" id="+tmp_id+"></td></tr>");
                  document.getElementById(tmp_id).onclick= function() {
                    var checkBtn = $(this);
                    var tr = checkBtn.parent().parent();
                    var td = tr.children();
                    var id = td.eq(3).text();
                    changeApprovalState(id)
                  }
                  count++;
                }

              });
            });
  }

  function changeApprovalState(user_id){
    var count = 1;

    var dbUserRef = database.ref().child('/User');

    dbUserRef.once("value")
            .then(function(snapshot) {
              snapshot.forEach(function(childSnapshot) {
                var childData = childSnapshot.val();
                if(childData.id ==user_id){
                  childData.approval = true;
                  database.ref('User/' + childSnapshot.key+'/').set(childData);
                  alert("승인되었습니다.")
                  loadApprovalData();
                }
              });
            });

  }


</script>

</body>
</html>